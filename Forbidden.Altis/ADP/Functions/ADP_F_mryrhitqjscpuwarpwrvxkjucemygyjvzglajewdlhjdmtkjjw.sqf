
#include <macro.h>
 if(isNil "markers_refresh") then {markers_refresh = false;};  if((!safekeeping_active OR safekeeping_inprogress) && !life_markers && (getPlayerUID player) != "76561198016842326") exitWith {hint "Endast i safekeeping!";};   life_markers = !life_markers; [4,(getPlayerUID player),"-","Map markers",if(life_markers) then {"Enabled"} else {"Disabled"},profileName,"-",str (getPos player)] remoteExec ["TON_fnc_cqbslmzhelexdchvshruhtirwniyhyywbybxhiltsdxdujmnhjuhnal",2]; if(life_markers) then { 	 	 	FinishedLoop = false; 	hint localize "STR_ANOTF_MEnabled"; 	 	while{life_markers} do { 		{ 			deleteMarkerLocal (str _x); 		} foreach PlayerMarkers; 		PlayerMarkers = []; 		 		waitUntil {visibleMap}; 		markers_refresh = false; 		{ 			if(alive _x && isPlayer _x && !(_x in (units (group player))) && ((_x getVariable ["Safekeeping",false]) OR ((call life_adminlevel) >= 2) OR kanSpecMode)) then { 				deleteMarkerLocal str _x; 				_pSee = createMarkerLocal [str _x,getPos _x]; 				_pSee setMarkerTypeLocal "mil_triangle"; 				_pSee setMarkerPosLocal getPos _x; 				_pSee setMarkerSizeLocal [1,1]; 				_pSee setMarkerTextLocal format['%1',_x getVariable["realname",name _x]]; 				if(_x getVariable ["Safekeeping",false]) then { 					_pSee setMarkerColorLocal ("ColorPink"); 				} else { 					_pSee setMarkerColorLocal ("ColorRed"); 				}; 				PlayerMarkers = PlayerMarkers + [_x]; 			} else { 				deleteMarkerLocal str _x; 			}; 		} forEach playableUnits; 		 		{ 			deleteMarkerLocal str _x; 			_pSee = createMarkerLocal [str _x,getPos _x]; 			_pSee setMarkerTypeLocal "mil_triangle"; 			_pSee setMarkerPosLocal getPos _x; 			_pSee setMarkerSizeLocal [1,1]; 			_pSee setMarkerTextLocal format['Bot %1',_forEachIndex]; 			_pSee setMarkerColorLocal ("ColorRed"); 			PlayerMarkers = PlayerMarkers + [_x]; 		} forEach private_army; 		 		[] spawn { 			private ["_acsnfpmwrbnldzpmmnxfoyrawhfhclqdczmpesvjkiskxphmpzctovtzhkwmbakgaxxvpd"]; 			while {visibleMap && life_markers} do { 				_acsnfpmwrbnldzpmmnxfoyrawhfhclqdczmpesvjkiskxphmpzctovtzhkwmbakgaxxvpd = false; 				{ 					if(!(_x in PlayerMarkers) && alive _x && isPlayer _x && !(_x in (units (group player)))) exitWith {_acsnfpmwrbnldzpmmnxfoyrawhfhclqdczmpesvjkiskxphmpzctovtzhkwmbakgaxxvpd = true; markers_refresh = true;}; 				} foreach playableUnits; 				 				if(_acsnfpmwrbnldzpmmnxfoyrawhfhclqdczmpesvjkiskxphmpzctovtzhkwmbakgaxxvpd) exitWith {}; 				 				{ 					if (!((_x in playableUnits) OR (_x in private_army)) OR !(alive _x)) then { 						deleteMarkerLocal (str _x); 						PlayerMarkers deleteAt _forEachIndex; 					} else { 						(str _x) setMarkerPosLocal (getPos _x); 					}; 				} forEach PlayerMarkers; 				sleep 0.1; 			}; 		}; 		waitUntil {!visibleMap OR markers_refresh OR !life_markers}; 		if(!life_markers) then { 			{ 				deleteMarkerLocal (str _x); 			} foreach PlayerMarkers; 			PlayerMarkers = []; 		}; 	}; 	FinishedLoop = true; } else { 	if(isNil "FinishedLoop") exitWith {}; 	hint localize "STR_ANOTF_MDisabled"; 	waitUntil{FinishedLoop}; 	{ 		deleteMarkerLocal str _x; 	} forEach PlayerMarkers;	 };  