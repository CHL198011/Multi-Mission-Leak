private['_DAu','_dmJ','_qUNP','_PKU','_KxLl','_FlU','_aSsP'];if(visibleMap || {!alive player} || {dialog} || {qbqKYXz}) exitWith {500 cutText["","PLAIN"];};_DAu = uiNamespace getVariable ["kYdkbSo",displayNull];if(isNull _DAu) then { 500 cutRsc["kYdkbSo","PLAIN"]; _DAu = uiNamespace getVariable ["kYdkbSo",displayNull];};_dmJ = nearestObjects[(visiblePosition player),["Man"],50];_dmJ = _dmJ - [player];{ _PKU = _DAu displayCtrl (78000 + _forEachIndex); if(!(lineIntersects [eyePos player, eyePos _x, player, _x]) && {!isNil {_x getVariable "aOsyc"}}) then { _KxLl = [visiblePosition _x select 0, visiblePosition _x select 1, ((_x modelToWorld (_x selectionPosition "head")) select 2)+.5]; _FlU = worldToScreen _KxLl; _aSsP = _KxLl distance player; if(count _FlU > 1 && {_aSsP < 15}) then { _qUNP = switch (true) do { case (_x in (units (group player)) && ((side _x) in [civilian, east])): { if(_x getVariable["aNace",false]) then { format["<t color='#00FF00'><t color='#00FF00'>[Neuling]</t> %1</t>",(_x getVariable "aOsyc")]; } else { format["<t color='#00FF00'>%1</t>",(_x getVariable "aOsyc")]; }; }; case (!isNil {(_x getVariable "rank")} && (side _x) isEqualTo west): { if(_x getVariable["ZbrguZt",""] == "AT2") then { _x getVariable "aOsyc" }else{ format["<img image='%1' size='1'></img> <t size='1.2' color='#006F43'>%3<br/></t>%2", switch (_x getVariable "rank") do { case 2: {"\a3\ui_f\data\gui\cfg\Ranks\corporal_gs.paa"}; case 3: {"\a3\ui_f\data\gui\cfg\Ranks\sergeant_gs.paa"}; case 4: {"\a3\ui_f\data\gui\cfg\Ranks\lieutenant_gs.paa"}; case 5: {"\a3\ui_f\data\gui\cfg\Ranks\captain_gs.paa"}; case 6: {"\a3\ui_f\data\gui\cfg\Ranks\major_gs.paa"}; case 7: {"\a3\ui_f\data\gui\cfg\Ranks\colonel_gs.paa"}; case 8: {"\a3\ui_f\data\gui\cfg\Ranks\general_gs.paa"}; default {"\a3\ui_f\data\gui\cfg\Ranks\private_gs.paa"}; }, _x getVariable "aOsyc", switch ((_x getVariable "rank")) do { case 2: {"Wachtmeister"}; case 3: {"Oberwachtmeister"}; case 4: {"Kommissar"}; case 5: {"Oberkommissar"}; case 6: {"Hauptkommissar"}; case 7: {"Polizeivorstand"}; case 8: {"Nicht Belegt"}; default {"Rekrut"}; } ] }; }; case ((!isNil {_x getVariable "aOsyc"} && (side _x) isEqualTo independent)): { format["%2<br/>%1", _x getVariable "aOsyc", switch (_x getVariable "rank") do { case 1: {"<t color='#FF0000'><img image='a3\ui_f\data\map\MapControl\hospital_ca.paa' size='1.5'></img></t><t size='0.8' color='#EDF5F5'>Feuerwehrmann-Anw</t>"}; case 2: {"<t color='#FF0000'><img image='a3\ui_f\data\map\MapControl\hospital_ca.paa' size='1.5'></img></t><t size='0.8' color='#EDF5F5'>Feuerwehrmann</t>"}; case 3: {"<t color='#FF0000'><img image='a3\ui_f\data\map\MapControl\hospital_ca.paa' size='1.5'></img></t><t size='0.8' color='#EDF5F5'>Oberfeuerwehrmann</t>"}; case 4: {"<t color='#FF0000'><img image='a3\ui_f\data\map\MapControl\hospital_ca.paa' size='1.5'></img></t><t size='0.8' color='#EDF5F5'>Unterbrandmeister</t>"}; case 5: {"<t color='#FF0000'><img image='a3\ui_f\data\map\MapControl\hospital_ca.paa' size='1.5'></img></t><t size='0.8' color='#EDF5F5'>Brandmeister</t>"}; case 6: {"<t color='#FF0000'><img image='a3\ui_f\data\map\MapControl\hospital_ca.paa' size='1.5'></img></t><t size='0.8' color='#EDF5F5'>Oberbrandmeister</t>"}; case 7: {"<t color='#FF0000'><img image='a3\ui_f\data\map\MapControl\hospital_ca.paa' size='1.5'></img></t><t size='0.8' color='#EDF5F5'>Wehrf√ºhrer</t>"}; default {"Feuerwehr"}; } ]; }; case (_x isequalto nsa) : {"Agent Orange"}; default { if !((group _x getVariable["HNCqyH",[]]) isEqualTo []) then { if(_x getVariable["aNace",false]) then { format["<t color='#00FF00'>[Neuling]</t> %1<br/><t size='0.9' color='#B6B6B6'>%2</t>",_x getVariable "aOsyc",((group _x) getVariable "HNCqyH") select 1]; } else { format["%1<br/><t size='0.9' color='#B6B6B6'>%2</t>",_x getVariable "aOsyc",((group _x) getVariable "HNCqyH") select 1]; }; } else { if(_x getVariable["aNace",false]) then { format["<t color='#00FF00'>[Neuling]</t> %1",_x getVariable "aOsyc"]; } else { _x getVariable "aOsyc"; }; }; }; }; if(_x getVariable ["speaking",false]) then { _qUNP = format ["<img image='\A3\ui_f\data\igui\rscingameui\rscdisplayvoicechat\microphone_ca.paa' size='1.5'></img>"] + _qUNP; }; _PKU ctrlSetStructuredText parseText _qUNP; _PKU ctrlSetPosition [_FlU select 0, _FlU select 1, 0.4, 0.65]; _PKU ctrlSetScale 0.8; _PKU ctrlSetFade 0; _PKU ctrlCommit 0; _PKU ctrlShow true; } else { _PKU ctrlShow false; }; } else { _PKU ctrlShow false; };} forEach _dmJ;