/*
	Darkside Life

	Author: Shawn "Huntah" Macgillivray

	Description:
	Opens the market list
*/

private["_helpStr","_action","_option1","_option2","_option3","_option4","_close","_next","_title","_textArea","_current","_display","_question","_display","_name","_crimes","_bounty","_units","_players","_jobsList"];
disableSerialization;


if((DSL_car)&&((_this select 0) == 0))exitwith{hint "You already have this license"};
if((DSL_truck)&&((_this select 0) == 1))exitwith{hint "You already have this license"};
if((DSL_air)&&((_this select 0) == 2))exitwith{hint "You already have this license"};
if((DSL_boat)&&((_this select 0) == 3))exitwith{hint "You already have this license"};
if((DSL_weapons)&&((_this select 0) == 4))exitwith{hint "You already have this license"};
if((DSL_weaponsAdv)&&((_this select 0) == 5))exitwith{hint "You already have this license"};
if(DS_debug)then
	{
	systemchat format ["------------ License Index = %1 -----------",(_this select 0)];
	};
_action = true;
_exit = false;

if(((_this select 0) == 2)&&((DS_infoArray select 13) > 49))then {
	_basePrice = 5500;
	_action = [
		format ["Because you are a skilled pilot you no longer need to sit the license test, instead you are to pay $%1 to be granted to the license",[_basePrice] call DS_fnc_numberText],
		"No Test Needed",
		"Purchase",
		"No Thanks"
	] call BIS_fnc_guiMessage;
	if(!_action)exitwith{_exit = true};
	if([_basePrice,true] call DS_fnc_checkMoney)exitwith{hint "You do not have enough money in your bank to purchase this license";_exit = true};
	[_basePrice,true,false] call DS_fnc_handleMoney;
	DSL_air = true;
	hint "Air license purchased";
	_exit = true;
};

if(((_this select 0) == 0)&&((DS_infoArray select 13) > 44))then {
	_basePrice = 100;
	_action = [
		format ["Because you are a skilled driver you no longer need to sit the license test, instead you are to pay $%1 to be granted to the license",[_basePrice] call DS_fnc_numberText],
		"No Test Needed",
		"Purchase",
		"No Thanks"
	] call BIS_fnc_guiMessage;
	if(!_action)exitwith{_exit = true};
	if([_basePrice,true] call DS_fnc_checkMoney)exitwith{hint "You do not have enough money in your bank to purchase this license";_exit = true};
	[_basePrice,true,false] call DS_fnc_handleMoney;
	DSL_car = true;
	hint "Car license purchased";
	_exit = true;
};

if(((_this select 0) == 1)&&((DS_infoArray select 13) > 44))then {
	_basePrice = 500;
	_action = [
		format ["Because you are a skilled driver you no longer need to sit the license test, instead you are to pay $%1 to be granted to the license",[_basePrice] call DS_fnc_numberText],
		"No Test Needed",
		"Purchase",
		"No Thanks"
	] call BIS_fnc_guiMessage;
	if(!_action)exitwith{_exit = true};
	if([_basePrice,true] call DS_fnc_checkMoney)exitwith{hint "You do not have enough money in your bank to purchase this license";_exit = true};
	[_basePrice,true,false] call DS_fnc_handleMoney;
	DSL_truck = true;
	hint "Truck license purchased";
	_exit = true;
};

if(_exit)exitwith{};

_attempt = [(_this select 0)] call DS_civ_licenseTestAttempt;
_current = [(_this select 0),DS_licenseIndex] call DS_civ_licenseTestConfig;

if(DS_licenseIndex == 0)then
	{

	_action = [
		format ["Because this is attempt number %1, this test will cost you $%2<br/><br/>All answers to these questions can be found on the map screen under 'Laws', Do not ask in help chat for the answers",(_attempt select 0),[(_attempt select 1)] call DS_fnc_numberText],
		"License Test",
		"Do test",
		"No Thanks"
	] call BIS_fnc_guiMessage;

	};
if(!_action)exitwith{closeDialog 0;};

closeDialog 0;
sleep 0.2;
createDialog "licenseTest";

7 enableChannel [false, false];
8 enableChannel [false, false];
9 enableChannel [false, false];

DS_blockEsc = (findDisplay 323345) displayAddEventHandler ["KeyDown", "if ((_this select 1) == 1) then { true }"];

_display = findDisplay 323345;
_title = _display displayCtrl 1101;
_question = _display displayCtrl 1100;
_next = _display displayCtrl 2400;
_close = _display displayCtrl 2401;
_option1 = _display displayCtrl 1102;
_option2 = _display displayCtrl 1103;
_option3 = _display displayCtrl 1104;
_option4 = _display displayCtrl 1105;

if(DS_licenseIndex == 0)then
	{
	if([(_attempt select 1),true] call DS_fnc_checkMoney)exitwith{closeDialog 0;hint "You do not have enough money in your bank to do this test"};
	[(_attempt select 1),true,false] call DS_fnc_handleMoney;
	};

_title ctrlSetStructuredText parseText format [
"<t color='#2E64FE' align='center'>This is attempt number %1 of this license</t><br/>
<t color='#2E64FE' align='center'>This is costing you $%2</t>",
(_attempt select 0),
[(_attempt select 1)] call DS_fnc_numberText];

switch(_this select 0)do
	{
	case 0:
		{
		_helpStr = "You can lower this licenses test price by completing truck driving or fuel delivery missions";
		};
	case 1:
		{
		_helpStr = "You can lower this licenses test price by completing truck driving or fuel delivery missions";
		};
	case 2:
		{
		_helpStr = "You can lower this licenses test price by completing crop dusting/cargo pilot or air taxi missions";
		};
	case 3:
		{
		_helpStr = "You can lower this licenses test price by completing water taxi missions";
		};
	case 4:
		{
		_helpStr = "You can lower this licenses test price by completing all legal missions";
		};
	case 5:
		{
		_helpStr = "You can lower this licenses test price by completing all legal missions";
		};
	};

_question ctrlSetStructuredText parseText format [
"<t color='#4CCF00' align='center'>Question<br/><br/>%1</t><br/><br/><br/><br/><t align='center'>%2</t>
",(_current select 0),_helpStr];

_option1 ctrlSetStructuredText parseText format [
"<t color='#4CCF00' align='center'>%1</t>
",(_current select 1)];

_option2 ctrlSetStructuredText parseText format [
"<t color='#4CCF00' align='center'>%1</t>
",(_current select 2)];

_option3 ctrlSetStructuredText parseText format [
"<t color='#4CCF00' align='center'>%1</t>
",(_current select 3)];

_option4 ctrlSetStructuredText parseText format [
"<t color='#4CCF00' align='center'>%1</t>
",(_current select 4)];

_next ctrlEnable true;
_next ctrlSetTooltip "Select an answer before pressing this";
switch(_this select 0)do
	{
	case 0:
		{
		_next buttonSetAction "[0] spawn DS_civ_checkAnswer; closeDialog 0;";
		};
	case 1:
		{
		_next buttonSetAction "[1] spawn DS_civ_checkAnswer; closeDialog 0;";
		};
	case 2:
		{
		_next buttonSetAction "[2] spawn DS_civ_checkAnswer; closeDialog 0;";
		};
	case 3:
		{
		_next buttonSetAction "[3] spawn DS_civ_checkAnswer; closeDialog 0;";
		};
	case 4:
		{
		_next buttonSetAction "[4] spawn DS_civ_checkAnswer; closeDialog 0;";
		};
	case 5:
		{
		_next buttonSetAction "[5] spawn DS_civ_checkAnswer; closeDialog 0;";
		};
	};
_next ctrlSetStructuredText parseText "<t size='1'>      Next Question</t>";

_close ctrlEnable true;
_close ctrlSetTooltip "Close menu (This will still count as an attempt";
switch(_this select 0)do
	{
	case 0:
		{
		_close buttonSetAction "[0] spawn DS_civ_closeTest; closeDialog 0;";
		};
	case 1:
		{
		_close buttonSetAction "[1] spawn DS_civ_closeTest; closeDialog 0;";
		};
	case 2:
		{
		_close buttonSetAction "[2] spawn DS_civ_closeTest; closeDialog 0;";
		};
	case 3:
		{
		_close buttonSetAction "[3] spawn DS_civ_closeTest; closeDialog 0;";
		};
	case 4:
		{
		_close buttonSetAction "[4] spawn DS_civ_closeTest; closeDialog 0;";
		};
	case 5:
		{
		_close buttonSetAction "[5] spawn DS_civ_closeTest; closeDialog 0;";
		};
	};
_close ctrlSetStructuredText parseText "<t size='0.9'>  Close</t>";